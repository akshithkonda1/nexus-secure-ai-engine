worker_processes  auto;
events { worker_connections 1024; }
http {
  limit_req_zone $binary_remote_addr zone=api_rate:10m rate=10r/s;
  server {
    listen 8443 ssl http2;
    # If terminating TLS here, add ssl_certificate / ssl_certificate_key.

    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header X-Content-Type-Options "nosniff" always;

    location / {
      client_max_body_size 1m;
      limit_req zone=api_rate burst=20 nodelay;
      proxy_read_timeout 35s;
      proxy_connect_timeout 3s;
      proxy_send_timeout 35s;
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_pass http://app:8080;
    }
  }
}
